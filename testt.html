<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dear Lottery Result Today</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= CSS ================= -->
<style>
*{
  box-sizing:border-box;
  font-family:Segoe UI, Arial, sans-serif;
}

body{
  margin:0;
  background:#f4f6fb;
  color:#222;
  overflow-x:hidden;
}

/* ===== CONTAINER ===== */
.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin:16px auto;
  max-width:680px;
  width:100%;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  text-align:center;
  overflow:hidden;
}

.card h3{
  margin:6px 0;
  color:#0a2a66;
}

.date-show{
  font-size:13px;
  color:#555;
}

/* ===== IMAGE PREVIEW (FIXED) ===== */
.img-preview{
  width:100%;
  max-width:100%;
  height:auto;
  display:block;
  margin:12px auto;
  border-radius:10px;
  object-fit:contain;
}

/* ===== STATUS ===== */
.status{
  padding:16px;
  font-size:14px;
  font-weight:600;
  color:#666;
  display:none;
}

/* ===== BUTTON ===== */
.refresh-btn{
  margin:10px 6px;
  padding:10px 20px;
  border:none;
  border-radius:20px;
  background:#0a2a66;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  display:none;
}

a.refresh-btn{
  background:#16a34a;
  text-decoration:none;
}

a.refresh-btn:hover{
  background:#15803d;
}

/* ===== LOADING ===== */
.loading-wrap{
  display:inline-flex;
  align-items:center;
  gap:8px;
}

.mini-spinner{
  width:14px;
  height:14px;
  border:2px solid #ddd;
  border-top:2px solid #1e3a8a;
  border-radius:50%;
  animation:spin .7s linear infinite;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}
</style>
</head>

<body>

<div class="container">
  <div id="todayResults"></div>
</div>

<!-- ================= JS ================= -->
<script>
/* ===== IMAGE SERVER ===== */
const IMAGE_BASE = "https://dhankesari.net/old/img";

/* ===== PDF SERVER ===== */
const PDF_BASE = "https://nagalandstatelotterysambad.com/wp-content/uploads/2026/01/";

/* ===== DRAWS ===== */
const draws = [
  { title:"ðŸŒ… Dear Morning 1PM", img:"1PM", prefix:"MD", pdf:"MN" },
  { title:"â˜€ï¸ Dear Day 6PM",     img:"6PM", prefix:"DD", pdf:"DN" },
  { title:"ðŸŒ™ Dear Night 8PM",   img:"8PM", prefix:"ED", pdf:"EN" }
];

/* ===== TIME LOCK ===== */
const TIME_LOCK = { MD:13, DD:18, ED:20 };

/* ===== TIME CHECK ===== */
function isTimeAllowed(prefix){
  const hour = Number(
    new Date().toLocaleString("en-IN",{
      timeZone:"Asia/Kolkata",
      hour:"2-digit",
      hour12:false
    })
  );
  return hour >= TIME_LOCK[prefix];
}

/* ===== DATE ===== */
function todayCode(){
  const d = new Date(
    new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Kolkata"})
  );
  return {
    img: String(d.getDate()).padStart(2,"0") +
         String(d.getMonth()+1).padStart(2,"0") +
         String(d.getFullYear()).slice(-2),
    pdf: String(d.getDate()).padStart(2,"0") +
         String(d.getMonth()+1).padStart(2,"0") +
         String(d.getFullYear()).slice(-2)
  };
}

/* ===== LOAD ===== */
function loadToday(){
  const wrap = document.getElementById("todayResults");
  wrap.innerHTML = "";
  const code = todayCode();

  draws.forEach(d => {

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3>${d.title}</h3>
      <div class="date-show">${new Date().toDateString()}</div>
    `;

    if(!isTimeAllowed(d.prefix)){
      const status = document.createElement("div");
      status.className = "status";
      status.style.display = "block";
      status.textContent = "Result not published yet";
      card.appendChild(status);
      wrap.appendChild(card);
      return;
    }

    const img = document.createElement("img");
    img.className = "img-preview";
    img.src = `${IMAGE_BASE}/${d.img}/${d.prefix}${code.img}.webp`;

    const status = document.createElement("div");
    status.className = "status";
    status.innerHTML = `
      <div class="loading-wrap">
        <span class="mini-spinner"></span>
        Loading Result...
      </div>
    `;
    status.style.display = "block";

    const retry = document.createElement("button");
    retry.className = "refresh-btn";
    retry.textContent = "Retry";

    const download = document.createElement("a");
    download.className = "refresh-btn";
    download.textContent = "Download PDF";
    download.target = "_blank";
    download.href = `${PDF_BASE}${d.pdf}${code.pdf}.pdf`;

    img.onload = ()=>{
      status.style.display = "none";
      download.style.display = "inline-flex";
    };

    img.onerror = ()=>{
      status.textContent = "File not uploaded yet. Please try after sometime.";
      retry.style.display = "inline-flex";
      download.style.display = "inline-flex";
    };

    retry.onclick = ()=>{
      status.style.display = "block";
      retry.style.display = "none";
      img.src = img.src.split("?")[0] + "?t=" + Date.now();
    };

    card.append(img, status, retry, download);
    wrap.appendChild(card);
  });
}

loadToday();
</script>

</body>
</html>
